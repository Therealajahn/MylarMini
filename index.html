<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mylar Mini</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      body {
        width: 100vw;
        height: 100vh;
        display: grid;
      }

			.plate{
        justify-self: center;
        align-self: center;
        display: grid;
        border-radius: 1vw;
			}
      .back.plate {
        width: 60vw;
        height: 30vw;
        background: black;
        grid-template-rows: 20% 20% 60%;
        grid-template-columns: 1fr;
			}
      .top.plate {
        width: 90%;
        height: 90%;
        background: grey;
        display: grid;
      }
      .mid.plate {
        width: 90%;
        height: 90%;
        background: grey;
        display: grid;
      }
        width: 90%;
        height: 90%;
        background: grey;
        display: grid;
      }

      panels-wrapper {
        justify-self: center;
        align-self: center;
        width: 99%;
        height: 99.9%;
        display: grid;
        grid-template-rows: 1fr;
        grid-template-columns: repeat(8, 1fr);
      }
      .panel {
        justify-self: center;
        align-self: center;
        width: 90%;
        height: 95%;
        background: #7d7d7d; 
        border-radius: 0.5vw;
        display: grid;
        grid-template-rows: 1fr;
				border: .25vw solid white; 
      }

			panel-center {
        justify-self: center;
        align-self: center;
        width: 95%;
				height: 48%; 
        border-radius: 0.5vw;
        display: grid;
				background: darkgrey;
				border: .15vw solid white; 				grid-template-columns: 1fr;
				grid-template-rows: 1fr 2fr 1fr;
				grid-template-areas:
				"top"
				"mid"
				"bot"
			}

			top-of-center{
				display:grid;
				grid-template-columns:repeat(4,1fr);
				grid-template-rows:1fr;
				margin-top: -1.5vw;
			}
			mid-of-center{
				display:grid;
				grid-template-columns:repeat(4,1fr);
				grid-template-rows:1fr 1fr;
			}
			bottom-of-center{
				display:grid;
			}
			square-button{
        justify-self: center;
        align-self: center;
        border-radius: 0.5vw;
				display:grid; 
				z-index:999; 
			}
			part-of-button{
				width: 1.1vw;
				height: 1.1vw;
        border-radius: 0.2vw;
				border: .15vw solid white;				
			}
			part-of-button.top{
				background: black;
				z-index:999;
			}
			part-of-button.bottom{
				margin-top: -0.9vw; 
				background: darkgrey ;
				z-index:0;
			}

    </style>
  </head>
  <body>

    <back-plate>
      <top-plate></top-plate>
      <mid-plate></mid-plate>
      <main-plate>
			</main-plate>
    </back-plate>

    <script>
      const backPlate = document.querySelector("back-plate");
      backPlate.setAttribute("class", "back plate");

      const topPlate = document.querySelector("top-plate");
      topPlate.setAttribute("class", "top plate");

      const midPlate = document.querySelector("mid-plate");
      midPlate.setAttribute("class", "mid plate");

      const mainPlate = document.querySelector("main-plate");
      mainPlate.setAttribute("class", "main plate");
      const panelsWrapper = document.createElement("panels-wrapper");
      mainPlate.appendChild(panelsWrapper);

      function repeatElement({ repititions, elementSuffix, elementPrefix, props, childProps, parentName, callback }) {
        for (let i = 0; i < repititions; i++) {
          let currentElement;

					typeof elementPrefix === "string" ? 
						execute(elementPrefix) :
						typeof elementPrefix === "object" ? 
							elementPrefix[i] ? execute(elementPrefix[i]) : null : null; 
							
					if(props)apply(props);
					
					function execute(elementPrefix){
						currentElement = document.createElement(`${elementPrefix}-${elementSuffix}`);
						currentElement.setAttribute("class", `${elementSuffix}`);
						parentName.appendChild(currentElement);
						if(callback) callback( currentElement,props );
					}
					function apply(props){
						for(prop in props){
							currentElement.style[prop] = props[prop];
							console.log("prop: ",currentElement.style);
						}
					}

					if(elementPrefix === "object" && elementPrefix.length !== repititions){
						throw new Error(
							`Array length doesn't match repititions for ${elementSuffix}: ${i}`)
					}
				}
			}

      repeatElement({
        repititions: 8,
				elementSuffix:"panel",
				elementPrefix:[
					"rhythm",
				],
        parentName: panelsWrapper,
				callback: customizePanel,
      });

			function customizePanel(element){
				console.log('element',element.tagName);
				switch(element.tagName){
					case 'RHYTHM-PANEL':
						createRythmPanel();
					break;
				}

				////////PANEL COMPONENTS//////////////
				function createRythmPanel(topColor,bottomColor){
					//add center
					//<panel-center>
					//	<top-of-center></top-of-center>
					//	<mid-of-center></mid-of-center>
					//</panel-center>
					const panelCenter = document.createElement('panel-center');
					element.appendChild(panelCenter);
					//add a top wrapper
					//<top-of-center></top-of-center>
					const topOfCenter = document.createElement('top-of-center');
					panelCenter.appendChild(topOfCenter);
					//add a midrapper
					//<mid-of-center></mid-of-center>
					const midOfCenter = document.createElement('mid-of-center');
					panelCenter.appendChild(midOfCenter); 
			    //add button component
					const squareButton = document.createElement('square-button');

					const bottomOfCenter = document.createElement('bottom-of-center');
					panelCenter.appendChild(bottomOfCenter);

					function squareButtonContent(squareButton,props){

						const buttonTopStyle = `style=${props?.buttonTop}` ?? ' '; 
						const buttonBottomStyle = `style=${props?.buttonBottom}` ?? ' ';

						squareButton.innerHTML = 
							`<part-of-button class='top' ${buttonTopStyle}></part-of-button>
							<part-of-button class='bottom' ${buttonBottomStyle}></part-of-button>`
						const buttonTop = squareButton.children[0];
						const buttonBottom = squareButton.children[1];

						//if(!props)return;	

						//if(props.topColor){
						//	buttonTop.style.background = props.topColor;
						//}
						//if(props.bottomColor){
						//	buttonBottom.style.background = props.bottomColor;
						//}
						//if(props.width){
						//	buttonTop.style.width = props.width;	
						//	buttonBottom.style.width = props.width;	
						//}
						//if(props.justifySelf){
						//	buttonTop.style.justifySelf = props.justifySelf;
						//	buttonBottom.style.justifySelf = props.justifySelf;
						//}
					}

					repeatElement({
						repititions: 4,
						elementPrefix:"square",
						elementSuffix:"button",
						parentName: topOfCenter,
						callback:squareButtonContent,
					});

					repeatElement({
						repititions: 8,
						elementPrefix: "square",
						elementSuffix: "button",
						childProps:{
							buttonBottom:{
								'background': 'black',
							},
						},
						parentName: midOfCenter,
						callback: squareButtonContent,
					});

					repeatElement({
						repititions: 1,
						elementPrefix: "square",
						elementSuffix: "button",
						props:{
							'justify-self':'center',
							'width': '95%',
						},
						parentName: bottomOfCenter,
						callback: squareButtonContent,
					});
				}
			}

    </script>
  </body>
</html>
